## [CH07_03] 환각 줄이기

### 환각이 발생하는 이유
- 프롬프트만 생성할경우
  - 희미한 기억에서 말을 꺼내는 것과 같음

### 환각을 최소화하는 방법
- 제공된 정보를 바탕으로 답변하라는 지시 명시
- 주어진 문서에서 질문의 답과 관련된 내용을 인용하라고 지시
  - **문서 요약**을 함께 제공하면 조금 더 정확한 결과를 얻을 수 있음
- 모른다는 답을 허용하는 것을 명시
  - 답이 없다고 추가 생성하는 것이 아닌
  - 답이 없다고 말할 수 있도록 가이드
- 프롬프트의 출력을 **사고**와 **답변** 섹션으로 분리
  - 생각하게 만들기
- 각각 다른 방법으로 **여러개의 출력**을 생성한 후
  - 각각의 답변이 **일관성**이 있는지 답변하라고 지시
  - **Self-Consistency**

### 프롬프트 예시 #1
- 질문과 관련 있는 부분을 먼저 찾고
- 그 문구를 정확히 인용 이후, 인용한 곳에서 답변을 하도록
- 컨텍스트에 없는 내용은 생성하려고 시도하지 말라고 명시적으로 지시
- 정보에 내용이 없으면 `관련된 내용을 찾을 수 없다`라고 답하라고
  - 여러번 반복하여 지시
- 질문에 대해 정확히 알고 있거나
  - 답을 하기에 정보가 부족하면 답변을 하지 말라고 함
- 답변이 확실치 않으면 답을 찾을 수 없다고 지시
```md
# Context
--- JOB POSTING---
마감된 공고는 아래의 경로를 통해 확인 가능합니다.

1. 원티드 채용 솔루션 [채용공고 관리] 클릭
2. 상단 [채용종료] 를 클릭하면 마감된 공고를 확인하실 수 있습니다.

* 마감된 공고를 다시 게시 원하실 경우, 게시 설정에서 원티드 공고 게시 ON, 게시 마감일을 다시 설정해주시면 됩니다
---

# Prompt Flow:
JOB POSTRING의 정보를 바탕으로 질문에 답변하세요

질문과 가장 관련성이 높은 내용을 찾으세요. 문구를 정확하게 인용하세요. JOB POSTING 정보에 없는 내용을 생성하려고 시도하지 마세요. 
JOB POSTING 정보에 질문과 관련된 내용이 없는 경우에는 "관련된 내용을 찾을 수 없습니다."라고 답하세요.

질문의 답을 정확히 알고 있거나, 답변을 하기에 정보가 충분한지 확인하세요. 충분한 정보를 바탕으로 정확히 답변 할 수 있는 경우에만 답하세요. 답변이 확실하지 않은 경우에는 "죄송합니다. 답을 찾을 수 없습니다."라고 답하세요.
```

### 프롬프트 예시 #2
- Selection Inference와 유사하게
- 요약, 인용
- 위와 Context는 동일
```md
JOB POSTING 의 내용을 요약하세요
->
{요약 내용 생성}
->
JOB POSTING 에서 질문과 관련된 내용을 인용하세요
->
{답변과 관련된 문장}
->
요약과 관련된 문장을 바탕으로 답변하세요
```

### CS 에이전트 예시
```md
# SYSTEM
당신은 원티드의 CS를 담당하는 원티드 AI입니다.
FAQ 정보를 바탕으로 질문에 답변하세요.

# USER
--- JOB POSTING---
마감된 공고는 아래의 경로를 통해 확인 가능합니다.

1. 원티드 채용 솔루션 [채용공고 관리] 클릭
2. 상단 [채용종료] 를 클릭하면 마감된 공고를 확인하실 수 있습니다.

* 마감된 공고를 다시 게시 원하실 경우, 게시 설정에서 원티드 공고 게시 ON, 게시 마감일을 다시 설정해주시면 됩니다

# USER
마감된 공고는 어떻게 확인하나요?
```
- 위 질문에는 잘 답변하나,
  - `"패스트캠퍼스의 강의를 구매하려면 어떻게 해야 하나요?"`와 같은 질문을 하게 되면 환각이 생김
- SYSTEM 프롬프트에 관련 내용 제공
```md
# SYSTEM
당신은 원티드의 CS를 담당하는 원티드 AI입니다.

FAQ 정보를 바탕으로 질문에 답변하세요.

질문과 가장 관련성이 높은 내용을 찾으세요. 문구를 정확하게 인용하세요. FAQ 정보에 없는 내용을 생성하려고 시도하지 마세요. FAQ 정보에 질문과 관련된 내용이 없는 경우에는 관련된 내용을 찾을 수 없 습니다."라고 답하고 종료하세요.

질문의 답을 정확히 알고 있거나, 답변을 하기에 정보가 충분한지 확인하세요. 충분한 정보를 바탕으로 정확히 답변 할 수 있 는 경우에만 답하세요. 답변이 확실하지 않 은 경우에는 "죄송합니다. 답을 찾을 수 없습니다."라고 답하세요.
```

### CS 에이전트 예시 #2
- Selection Inference
```md
# SYSTEM
당신은 원티드의 CS를 담당하는 원티드 AI입니다.
FAQ 정보를 바탕으로 질문에 답변하세요.

# USER
--- JOB POSTING---
마감된 공고는 아래의 경로를 통해 확인 가능합니다.

1. 원티드 채용 솔루션 [채용공고 관리] 클릭
2. 상단 [채용종료] 를 클릭하면 마감된 공고를 확인하실 수 있습니다.

* 마감된 공고를 다시 게시 원하실 경우, 게시 설정에서 원티드 공고 게시 ON, 게시 마감일을 다시 설정해주시면 됩니다

# USER
패스트캠퍼스의 강의를 구매하려면 어떻게 해야 하나요?

# USER
질문과 가장 관련성이 높은 내용을 찾으세요. 문구를 정확하게 인용하세요. FAQ 정보에 없는 내용을 생성하려고 시도하지 마세요. FAQ 정보에 질문과 관련된 내용이 없는 경우에는 관련된 내용을 찾을 수 없 습니다."라고 답하고 종료하세요.
```

### 결론 및 요약
- 만약 위 두가지 방법으로도 환각을 줄일 수 없다면,
  - Temperature 값을 낮추거나
  - GPT-4를 사용할 것
  - JSON 포맷으로 출력하여, 구조적으로 생각하게 만들기
  - 제공된 컨텍스트를 기반으로 답할 수 있도록
    - 컨텍스트의 내용을 인용한 다음에, 그 인용한 것을 기반으로 답변을 하게 하거나,
    - 인용한 내용에 답변이 없거나, 컨텍스트에 답변이 없는 경우
      - 답변이 없습니다라고 강제하기
- 환각은 100% 줄일 수 없음
  - **꼭 필요한 만큼 환각이 발생하지 않는지, 얼마나 발생하는지 확인 필요**
