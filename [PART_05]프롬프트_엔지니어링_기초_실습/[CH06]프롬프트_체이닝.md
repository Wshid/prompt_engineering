## [CH05_06] 프롬프트 체이닝

### 프롬프트 체이닝
- 일련의 프롬프트와 그에 따른 응답을 순서대로 연결
  - 하나의 지속적인 대화나 여러 하위 태스크로 이루어진 복잡한 태스크 수행
- Self-Consistency, Selection-Inference, Least-to-Most, React 등
  - 고수준의 프롬프트 엔지니어링은 거의 모두 프롬프트 체이닝 사용

### 프롬프트 체이닝 실습
- 단순 프롬프트 연결(생각하고, 결론내기)
- 이전 결과에 따른 분기 처리
- JSON 포맷을 이용한 결과 내 유사 체이닝 효과 주기

### 단순 프롬프트 연결
- Self-Consistency는 이전에 실습한 내용
  ```md
  # USER
  질문에 필요한 내용을 Context에서 추출해서 나열하세요. 답변은 하지 말고, 필요한 내용만 추출하세요

  # ASSISTANT
  - {리스트 형태의 답변}
  ```
- 이후 답변한 내용을 `Selection:`을 지정함(Selection-Inference)
  ```md
  # ASSISTANT
  Selection:
  - {리스트 형태의 답변}

  # USER
  Selection의 내용에 기반해 Question에 대해 답하세요
  ```
- 아주 정확한 답을 원할때는 `Temperature: 0`으로 지정

### 결과를 기반으로 분기 처리
```md
# USER
사용자의 질문을 다음의 두 유형으로 판단하세요
- 고민상담
- 인사

출력 포맷:
유형: {유형}

# ASSISTANT(입력)
안녕? 뭐하니?

# ASSISTANT
유형: 인사

# USER
유형이 고민상담인 경우, 한 줄로 공감해주세요.
유형이 인사인 경우, 인사를 받아주세요
```
- 똑같은 결과가 나오지 않을 수 있음
- 이렇게 하려면 API call이 여러개가 있어야 함
- 답변 반환 일관성을 높히려면 JSON 형태 반환을 사용하면 됨

### JSON 포맷 활용
```md
# USER
사용자의 질문을 다음의 두 type으로 판단하고, 판단 결과에 따라 답변하세요

[질문 type]
- 고민상담
- 인사

[type에 따른 답변]
- 고민상담인 경우, 한 줄로 공감해주세요
- 인사인 경우, 인사를 받아주세요

다음 JSON 포맷으로 결과를 출력해줘
"""
{
  "type": "고민상담|인사",
  "answer": "type에 따른 답변"
}
"""

# USER
안녕? 뭐하니?

# ASSISTANT
{
 "type": "인사",
 "answer": "안녕하세요" 
}
```
- 반환값에 type 뒤에 answer를 출력하는 방식
- 내부적으로 `type`을 먼저 생성하게 되고, 이를 `answer` 반환시에 참고하게 됨
  - 체이닝 효과
  - 답변안에서 간단히 CoT 사용
- 구조화된 결과
  - 정확도가 높아짐
