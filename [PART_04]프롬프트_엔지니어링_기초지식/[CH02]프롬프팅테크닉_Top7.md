## [CH04_02] 프롬프팅테크닉 Top 7

### Few-shot examples
- 모델에게 몇가지 예시 제공
- 그 예시를 참고하여 답변을 하도록 함
- 성능 향상
- 종류
  - Zero shot: 예제를 제공하지 x
  - One shot: 한 개의 예제 제공
  - Few shot: 두 개 이상의 예제 제공
- Zero shot, Few shot에서 큰 성능 차이는 없겠으나
  - 번역하는 스타일 변경등에 활용 가능

#### Zero shot
```bash
Translate English to French: # task description
cheese => # Prompt
```

#### One shot
```bash
Translate English to French: # task description
sea otter => loutre de mer # example
cheese => # prompt
```

#### Few shot
```bash
Translate English to French: # task description
sea otter => loutre de mer # examples
peppermint => menthe poivree # examples
plush girafe => girafe peluche # examples
cheese => # prompt
```
- Few shot example은 parameter가 큰 모델에서 효과적
- **Few shot 제약 사항**
  - 충분히 큰 모델에서만 유의미하게 작동
  - **산술 추론 문제**에는 적합하지 x
  - 정답을 정확히 주기보다 **레이블의 랜덤한 분포**를 가진것이 나옴
    - 샘플의 내용이나 논리가 아닌, **형식**만 참고

### Chain of Thought
- LLM에게
  - **이유에 대해서 설명하도록 만들어, 답을 더 정확하게 생성하도록 만드는 기술**
- 중간 추론 단계를 거치도록 하여
  - 복잡한 사고가 필요한 작업에 정확도 향상
- 답이 나오는 과정에 대해 설명한 예시를 보여주고,
  - 지시에 대한 답을 생성할 때
  - **예시와 동일한 방식으로 그에 대한 과정을 설명하도록 만듦**
- **생각에 대한 과정을 제공한다**

#### 잘못된 예시
```md
# prompt
Q: 철수는 테니스공 5개를 가지고 있습니다. 철수는 테니스공을 담은 통을 2개 더 샀는데, 각 통에는 테니스공 3개가 있습니다. 철수는 이제 몇 개의 테니스공을 가지고 있을까요?
A: 정답은 11개 입니다.

Q: 식당에 사과가 23개 있었습니다. 점심을 만들기 위해 20개를 사용하고 6개를 더 산 뒤 3 개를 먹었다면, 사과가 몇 개 남았을까요?
A: 

# output
A: 정답은 25개 입니다
```
- 정답을 내기 위한 포맷을 제공
- 산술 연산을 시키는 구조, 올바르지 않음

#### 올바른 예시
```md
# prompt
Q: 철수는 테니스공 5개를 가지고 있습니다. 철수는 테니스공을 담은 통을 2개 더 샀는데, 각 통에는 테니스 3개가 있습니다. 철수는 이제 몇 개의 테니스공을 가지고 있을까요?

**A: 철수는 처음에 테니스공 5개를 가지고 있었습니다. 통 하나에 테니스공 3개씩 들어있는 통을 2개 샀으니, 총 6개의 테니스공이 추가 됩니다. 5+ 6= 11. 따라서 답은 11개입니다.**

Q: 식당에 사과가 23개 있었습니다. 점심을 만들기 위해 20개를 사용하고 6개를 더 샀습니 다. 그 후에 3개를 먹었다면, 사과가 몇 개 남았을까요?
A:

# output
기존에 사과가 23개 있었고, 점심을 만들기 위해 20개를 사용하고 6개를 더 샀습니다. 그 후에 3개를 먹었다면, 사과가 남았을 것입니다. 따라서 답은 23+ 6- 20-3= 6개입니다.
```
- 예시에 대한 대답을
  - 답을 내는 과정을 제공함
- 주어진 답에 대한 추론 과정에 맞게 LLM이 답하게 됨

### Zero-shot CoT
- 다음 문구를 마지막에 추가하여
  - CoT 예제를 제공하는 것과 같은 효과
  - 성능 향상
- 문구
  ```md
  Let's think step by step
  단계별로 생각해봅시다
  차근차근 생각해봅시다
  ```
- 기초적인 문제 풀이에 효과적

#### 예시
```md
# prompt
Q: 식당에 사과가 23개 있었습니다. 점심을 만들기 위해 20개를 사용하고 6개를 더 샀습니 다. 그 후에 3개를 먹었다면, 사과가 몇 개 남았을까요? 단계별로 생각해봅시다
A:

# output
1. 처음에는 식당에 사과가 23개 있었습니다.
2. 점심을 만들기 위해 20개를 사용했으므로, 남은 사과는 23- 20= 3개입니다.
3. 그 후에 6개를 더 사서 현재 사과의 개수는 3+ 6= 9개입니다.
4. 마지막으로 3개를 먹었으므로, 남은 사과의 개수는 9-3= 6개입니다.
```

#### 특징
- Open AI Chat 형식의 경우
  - **Zero-shot CoT으로 대답하도록 하는 것이 기본으로 적용**되어 있음
- 어떤 경우는 오히려 성능 하락이 될 수 있기 때문에
  - **해당 문제를 풀기 위한 적절한 방법이 맞는지 여러 샘플로 확인 필요**

### Self Consistency
- 여러가지 방식의 CoT를 제공
- 이를 통해서 다양한 추론 방식을 거침
- 그 중에서 가장 일관된 답을 선택하는 방법
- LLM이 여러번 추론을 하면서 랜덤 경로 선택하여 답을 선택
- 파라미터가 많은 모델일 수록 잘 동작
- 논문에 따르면 20개 정도의 예시를 제공하는게 제일 성능이 좋았음
- 추론 경로를 최대한 다양하게 제공해야 하므로
  - **토큰 수를 많이 사용**
- 결과 취합을 위한 **후처리** 필요

#### 예시
- Q, A 하나씩이 모두 CoT
```md
# prompt
Q: 숲에는 나무가 15그루 있습니다. 숲에서 일하는 사람들이 오늘 숲에 나무를 심을 예정입니다. 그들이 일을 마친 후, 숲에는 나무가 21그루 있을 것입니다. 숲에서 일 하는 사람들이 오늘 몇 그루의 나무를 심었을까요?
A: 처음에는 나무가 15그루 있었습니다. 나중에는 나무가 21그루 있습니다. 차이는 심은 나무의 수여야 합니다. 그러므로, 그들은 21-15=6그루의 나무를 심었어야 합니다. 답은 6입니다.
Q. 주차장에 차가 3대 있고 2대의 차가 더 도착하면, 주차장에는 몇 대의 차가 있을까요?
A: 주차장에 이미 차가 3대 있습니다. 2대가 더 도착합니다. 이제 차는 3+ 2=5대 있습니다. 답은 5입니다.
Q: 리아는 초콜릿을 32개 가지고 있었고 그녀의 여동생은 42개를 가지고 있었습니다. 그들이 35개를 먹었다면, 총 몇 조각이 남아 있을까요?
A: 리아는 초콜릿을 32개 가지고 있었고 리아의 여동생은 42개를 가지고 있었습니다. 그래서 원래 초콜릿은 32+ 42= 74조각 있었습니다. 35조각이 먹혔습니다. 그 래서 총 74-35=39조각의 초콜릿이 아직 남아 있습니다. 답은 39입니다.
Q: 제이슨은 롤리팝 20개를 가지고 있었습니다. 그는 데니에게 몇 개의 롤리팝을 줬습니다. 이제 제이슨은 롤리팝 12개를 가지고 있습니다. 제이슨은 데니에게 몇 개 의 롤리팝을 줬을까요?
A: 제이슨은 롤리팝 20개를 가지고 있었습니다. 이제 그는 12개밖에 없으니, 나머지를 데니에게 준 것이어야 합니다. 그가 데니에게 준 롤리팝의 수는 20-12= 8개이 어야 합니다. 답은 8입니다.
Q. 손은 장난감을 5개 가지고 있습니다. 크리스마스에, 그는 엄마와 아빠 각각으로부터 장난감을 2개씩 받았습니다. 그는 이제 몇 개의 장난감을 가지고 있을까요?
A: 그는 장난감 5개를 가지고 있었습니다. 그는 엄마로부터 2개를 받았으므로, 그 후에는 5+ 2= 7개의 장난감을 가지게 됩니다. 그 다음에 아빠로부터 2개를 더 받았 으므로, 총 7+2=9개의 장난감을 가지게 됩니다. 답은 9입니다.
Q: 서버룸에는 컴퓨터가 9대 있었습니다. 월요일부터 목요일까지 매일 5대의 컴퓨터가 추가로 설치되었습니다. 이제 서버룸에는 몇 대의 컴퓨터가 있을까요?
A: 월요일부터 목요일까지는 4일입니다. 매일 5대의 컴퓨터가 추가되었습니다. 그러므로 총 4* 5= 20대의 컴퓨터가 추가되었습니다. 처음에는 컴퓨터가 9대 있었으 므로, 이제는 9+ 20=29대의 컴퓨터가 있습니다. 답은 29입니다.

# Output(여러번 수행)
## Try 1
식당에 사과가 23개 있었고, 점심을 만들기 위해 20개를 사용하고 6개를 더 샀습니다.
그런 다음, 3개는 먹었습니다. 그래서 사과가 총 23+ 6-20-3= 6개 남아 있습니다.
**답은 6입니다.**

## Try 2
식당에 사과가 23개 있었고, 점심을 만들기 위해 20개를 사용했습니다. 그리고 더 6개를 샀습 니다. 그 후에 사과 3개를 먹었습니다. 이제 사과가 몇 개 남았는지 계산해 보겠습니다.
사과가 23개 있었고, 점심을 만들기 위해 20개를 사용하였고, 더 6개를 샀습니다. 따라서 총 23+ 6= 29개의 사과가 있었습니다. 그리고 3개를 먹었으므로 이제 총 29-3= 26개의 사과 가 남아 있습니다. **답은 26입니다.**

## Try 3
A: 그들은 식당에 사과가 23개 있었고, 점심을 만들기 위해 20개를 사용하고 6개를 더 샀을 것입니다. 그리고 3개를 먹었습니다. 이는 사과가 23+ 6- 20-3= 6개 남아 있다는 것을 의미합니다. **답은 6입니다**
```
- 여러 사칙연산 하는 방법에 대한 CoT를 제공
- 실행할때마다 여러 CoT중 하나의 방식을 선택하여 답을 제공함
- 이 결과들을 보고 가장 많은 답이 나온 **답은 6입니다**를 선택